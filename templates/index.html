<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Dynamic Parts Table</title>
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

	<style>
		* {
			margin: 0px;
			padding: 0px;
			box-sizing: border-box;
			font-family: sans-serif;

		}

		nav {
			width: 100%;
			height: 75px;
			background-color: rgb(26, 107, 30, .9);
			color: black;
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0px 50px;
			top: 0;
		}

		.search form {
			background-color: white;
			/* set background color for the search bar */
			padding: 2px;
			border: 1px solid black;
			border-radius: 30px;
			/* adjust border-radius to make the search bar more elongated */
			margin-bottom: 20px;
			margin-top: 20px;
			margin-left: auto;
			width: 300px;
			/* set width for demonstration */
			display: flex;
			/* align input and button horizontally */
			align-items: center;
			/* center items vertically */
		}

		.search input {
			flex: 1;
			/* take up remaining space */
			padding: 3px 8px;
			border: none;
			outline: none;
			font-size: 14px;
			border-radius: 30px;
		}

		.search input:hover {
			border: 1px solid #7babe2;
		}

		.search button {
			background-color: black;
			color: white;
			border: none;
			outline: none;
			padding: 3px 10px;
			border-radius: 30px;
			cursor: pointer;
		}

		.adminLogin button {
			color: black;
			font-size: 14px;
			border: none;
			outline: black;
			margin-left: auto;
			padding: 3px 10px;
			border-radius: 30px;
			cursor: pointer;
		}

		/* BUTTONS */
		/* #addPartBtn {  } */
		/* #rmvPartBtn {  } */

		.btn-group form {
			background-color: white;
			padding: 7px;
		}

		.btn-in {
			background-color: rgb(26, 107, 30, .9);
			color: black;
			border: 1px solid black;
			padding: 5px 5px;
			margin-bottom: 20px;
			margin-top: 20px;
			margin-left: 5px;
			width: 70px;
			font-size: 20px;
		}

		.btn-out {
			background-color: rgb(26, 107, 30, .9);
			color: black;
			border: 1px solid black;
			padding: 5px 5px;
			margin-bottom: 20px;
			margin-top: 20px;
			margin-left: 10px;
			width: 70px;
			font-size: 20px;
		}

		.btn-submit {
			background-color: white;
			color: black;
			border: 1px solid black;
			width: 160px;
			margin-left: 10px;
		}

		.btn-primary1 {
			background-color: rgb(214, 214, 214);
			/* Set background color to white */
			color: black;
			/* Set text color to black */
			border: 1px solid black;
			/* Set border to black */
			width: 140px;
			margin-top: 20px;
			margin-left: 475px;
			padding: 5px;
		}

		.btn-primary2 {
			background-color: rgb(214, 214, 214);
			color: black;
			border: 1px solid black;
			width: 140px;
			margin-top: 20px;
			margin-left: 10px;
			padding: 5px;
		}

		/* TOPBAR AND LOGO */
		.logo {
			font-weight: bold;
			width: 100px;
			height: 50px;
			margin-bottom: 0px;
			margin-right: 0px;
			float: left;
		}

		.text-area-custom {
			margin: 0 10px 20px 10px;
		}

		/* TABLE */
		.table-striped #partsTableBody tr:nth-of-type(2n+1) {
			background-color: rgb(223, 223, 185);
		}

		.table td,
		.table th {
			padding: .25rem;
			vertical-align: top;
			border-top: 1px solid #dee2e6;
		}

		.table .sortable-column {
			cursor: pointer;
		}


	 .background-modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
  }
  .modal-form {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: auto;
    max-width: 1000px;
  }
  .modal-header, .modal-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 10px;
  }
  .modal-header {
    border-bottom: 1px solid #e5e5e5;
  }
  .modal-footer {
    border-top: 1px solid #e5e5e5;
    justify-content: flex-start;
  }
  .modal-content {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
  }
  .form-control {
    margin: 5px;
    flex-grow: 1;
    min-width: 120px; 
  }
  .close {
    cursor: pointer;
    font-size: 1.5rem;
  }
  .btn-success {
    margin-top: 20px; 
  }

	</style>
</head>

<body>
	<nav>
		<div class="logo">E-WASTE ENTERPRISES</div>
		<div class="adminLogin">
			<button type="button">Admin Login</button>
		</div>
	</nav>

	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-9">
				<div class="d-flex align-items-center">
					<!-- <button id="addPartBtn" class="btn btn-primary1">Add Part</button> -->
					<button id="showModalBtn" class="btn btn-primary2">Add Part</button>
					<button id="rmvPartBtn" class="btn btn-primary2">Remove Part</button>
				</div>
			</div>

			<div class="col-sm-3">
				<div class="search">
					<form>
						<input type="text" placeholder="Search">
						<button type="submit">Go</button>
					</form>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-sm-3">
				<textarea class="form-control text-area-custom" rows="3"></textarea>
				<div class="btn-group" role="group">
					<form>
						<button type="button" class="btn-in">IN</button>
						<button type="button" class="btn-out">OUT</button>
					</form>
				</div>
				<button type="button" class="btn btn-primary btn-lg btn-block btn-submit">Submit</button>
			</div>
			<div class="col-sm-9">
				<table class="table table-striped">
					<thead>
						<tr>
							<th class="sortable-column">Type</th>
							<th class="sortable-column">Capacity</th>
							<th class="sortable-column">Size</th>
							<th class="sortable-column">Speed</th>
							<th class="sortable-column">Brand</th>
							<th class="sortable-column">Model</th>
							<th class="sortable-column">Location</th>
							<th class="sortable-column">Serial Number</th>
						</tr>
					</thead>
					<tbody id="partsTableBody">
						<!-- Table data will be loaded here via AJAX -->
					</tbody>
				</table>
			</div>
		</div>
	</div>


	<button id="showModalBtn" class="btn btn-primary">Add Part</button>
	<div id="addPartModal" class="background-modal">
		<div class="modal-form">
		  <div class="modal-header">
			<h3>Add part manually</h3>
			<button class="close" id="closeModalBtn">&times;</button>
		  </div>
		  <div class="modal-body">
			<form id="addPartForm" class="form-inline">
			  <input type="text" id="type" placeholder="Type" class="form-control mb-2 mr-sm-2">
			  <input type="text" id="capacity" placeholder="Capacity" class="form-control mb-2 mr-sm-2">
			  <select id="size" class="form-control mb-2 mr-sm-2">
				<option value="No Size">Default Size</option>
				<option value="2.5'' HD">2.5'' HD</option>
				<option value="3.5'' HD">3.5'' HD</option>
				<option value="Laptop">Laptop</option>
				<option value="Desktop">Desktop</option>
			  </select>
			  <input type="text" id="speed" placeholder="Speed" class="form-control mb-2 mr-sm-2">
			  <input type="text" id="brand" placeholder="Brand" class="form-control mb-2 mr-sm-2">
			  <input type="text" id="model" placeholder="Model" class="form-control mb-2 mr-sm-2">
			  <input type="text" id="location" placeholder="Location" class="form-control mb-2 mr-sm-2">
			  <input type="text" id="snumber" placeholder="Serial Number" class="form-control mb-2 mr-sm-2">
			  <button type="button" id="add_btn" class="btn btn-primary mb-2">OK</button>
			</form>
		  </div>
		</div>
	  </div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		$(document).ready(function () {
			// a commonly used function to
			// show content of JSON object
			fetchAndDisplayParts();

			/* ====== EVENT LISTENERS ===== */
			// Sort column
			$('.sortable-column').click(function () {
				var column = $(this).text().trim();  // Get the column name
				handleSort(column);  // Call handleSort function with the column name
			});

			$('#showModalBtn').click(function () {
				$('#addPartModal').show();
			});

			$('#closeModalBtn').click(function () {
				$('#addPartModal').hide();
			});


			// Add part
			$('#add_btn').click(function () {
				const partData = {
					Type: $('#type').val(),
					Capacity: $('#capacity').val(),
					Size: $('#size').val(),
					Speed: $('#speed').val(),
					Brand: $('#brand').val(),
					Model: $('#model').val(),
					Location: $('#location').val(),
					Part_sn: $('#snumber').val()
				};
				handleAddPart(partData);
				});

			function fetchAndDisplayParts() {
				$.ajax({
					url: '/get_parts',
					type: 'POST',
					dataType: 'json',
					success: function (data) {
						var tableBody = $('#partsTableBody');
						console.log("GETS PARTS HERE 1")
						tableBody.empty(); // Clear existing rows
						$.each(data, function (index, part) {
							tableBody.append('<tr>' +
								'<td>' + part.Type + '</td>' +
								'<td>' + part.Capacity + '</td>' +
								'<td>' + part.Size + '</td>' +
								'<td>' + part.Speed + '</td>' +
								'<td>' + part.Brand + '</td>' +
								'<td>' + part.Model + '</td>' +
								'<td>' + part.Location + '</td>' +
								'<td>' + part.Part_sn + '</td>' +
								'</tr>');
						});
					},
					error: function (xhr, status, error) {
						console.error("Error fetching parts data: " + error);
					}
				});
			} // end fetchAndDisplayParts

			function handleSort(column) {
				console.log(partData);
				// Make an AJAX request to the server to retrieve sorted data
				$.ajax({
					url: '/sort_parts',  // URL for sorting route in app.py
					method: 'POST',
					data: { column: column },  // Send the column to sort by
					success: function (response) {
						// Replace the table body with sorted data
						$('#partsTableBody').html('');
						response.forEach(function (part) {
							$('#partsTableBody').append(`<tr>
							<td>${part.Type}</td>
							<td>${part.Capacity}</td>
							<td>${part.Size}</td>
							<td>${part.Speed}</td>
							<td>${part.Brand}</td>
							<td>${part.Model}</td>
							<td>${part.Location}</td>
							<td>${part.Part_sn}</td>
						</tr>`);
							// print("Sorted by " + column + " column.");
						});
					},
					error: function (xhr, status, error) {
						console.error("Error sorting parts: " + error);
					}
				}); // end handleSort
			}


			//how add part works=> clicking add button (showModalBtn) opens the modal, which then prompts user input, clicking 
			//submit sends data to server utilizing current add and handleadd functions
			function handleAddPart(partData) {
				$.ajax({
					url: '/add_part',
					type: 'POST',
					contentType: 'application/json',
					dataType: 'json',
					data: JSON.stringify(partData),
					success: function (response) {
						console.log("ADD PARTS HERE 1")
						if (response.status === 'success') {
							$('#addPartModal').hide(); // hide modal
							fetchAndDisplayParts(); //refresh page with new data immediately
							$('#addPartForm')[0].reset(); //resets form	
						} else {
							alert("Failed to add the part." + response.message);
						}
					},
					error: function (xhr, status, error) {
						console.error("Error adding part: " + error);
						alert("Error adding part. Ensure all boxes are filled. " + error);
					}
				});
			} // end handleAddPart
		});
	</script>
	
<!--modal html code-->
	
<!--<button type="button" id="open_button" class="button">Open Modal</button>-->
</body>
	
<div id="bgmodal" class="background-modal">
	<div class="modal-form">
		<span class="close">&times;</span>
	
		<p>Serial Number: <input type="text" id="serialnumber" name="serialnumber"></p>
	 
	
		<p>Add item to inventory. Fill blanks.&nbsp;</p>
		
		<table>
		<tr>
		<th> Type</th>
		<th>Capacity</th>
		<th>Size</th>
		<th>Speed</th>
		<th>Brand</th>
		<th>Model</th>
		<th>Location</th>
		<th>Serial Number</th>
		</tr>
		<tr>
		<th><input type="text" id="type" name="type" placeholder="Type"></th>
		<th><input type="text" id="capacity" name="Capacity" placeholder="Capacity"></th>
		<th><input type="text" id="size" name="Size" placeholder="Size"></th>
			<th> <input type="text" id="speed" name="Speed" placeholder="Speed"></th>
		<th><input type="text" id="brand" name="Brand" placeholder="Brand"></th>
		<th><input type="text" id="model" name="Model"  placeholder="Model"></th>
		<th><input type="text" id="location" name="Location" placeholder="Location"></th>
			<th><input type="text" id="snumber" name="serialnum" placeholder="Serial Number"></th>
		</tr>
		</table>
		
		<button type="button" id="cancel_btn">Cancel</button>
	
		<button type="button" id="add_btn">Add</button>
		
	</div>
	
	</div>
	<!--end code for modal-->

</html>
